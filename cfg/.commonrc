#!/bin/bash

# zsh

export ZSH=~/.oh-my-zsh

ZSH_THEME=""
export UPDATE_ZSH_DAYS=1
DISABLE_UPDATE_PROMPT="true"

plugins=(
    autoupdate
    fast-syntax-highlighting
    zsh-autosuggestions
    zsh-nvm
)

source $ZSH/oh-my-zsh.sh

# prompt

fpath+=("$NVM_DIR/versions/node/$(node -v)/lib/node_modules/pure-prompt/functions")
fpath+=("/data/data/com.termux/files/usr/lib/node_modules/pure-prompt/functions")

autoload -U promptinit; promptinit
prompt pure
PROMPT="%(?.%F{magenta}.%F{red}!%F{magenta})>%f "
PURE_CMD_MAX_EXEC_TIME=0

# aliases

alias nvmin="nvm install \$(cat .nvmrc) --reinstall-packages-from=\$(node -v | tr -d v)"
alias nvmup="nvm install node --reinstall-packages-from=node && npm i npm -g"
alias nvmclean="rm -rfv \$(ls -td \$NVM_DIR/versions/node/* | tail -n +2) && rm -rfv \$NVM_DIR/.cache/bin"

alias st="speed-test -b -v"
alias ip='curl ipinfo.io -s | jq && curl ifconfig.co/json -s | jq && curl ifconfig.me/all.json -s | jq'

alias gs="git status -s"
alias ga="gs && git add ."
alias gp="gs && git push"
alias gl="git log --pretty=format:'%C(yellow)%h %ad%Cred%d %Creset%s%Cblue [%cn]' --decorate --date=short"
alias gll="git log --pretty=format:'%C(yellow)%h %Cred%d %Creset%s%Cblue [%cn]' --decorate --numstat"
alias gbd="git branch -D \$(git branch | grep -v \* | xargs)"

alias sdock="defaults write com.apple.dock persistent-apps -array-add '{tile-data={}; tile-type='spacer-tile';}' && killall Dock"

APTS_UPDATE="apt-get update && apt-get dist-upgrade && apt-get autoremove && apt-get autoclean"
alias upall="$APTS_UPDATE"
alias supall="sudo sh -c \"$APTS_UPDATE\""

# functions

ARIA_ARGS=(--file-allocation=falloc --max-connection-per-server=3 --max-concurrent-downloads=3 --split=3 --max-tries=120 --retry-wait=5 --continue --remote-time)

download() {
    aria2c "$@" "${ARIA_ARGS[@]}"
}

youtube() {
    youtube-dl -o "youtube-dl/%(uploader)s - %(title)s.%(ext)s" --add-metadata --embed-subs --external-downloader aria2c --external-downloader-args "$(echo ${ARIA_ARGS[@]})" "$@"
}

gc() {
    gs && git commit -m "$@"
}

# colors

C_OFF="\033[0m"
C_GREEN="\033[0;32m"

# node versions
NODE_V_CURRENT=$(node -v)
NODE_V_REMOTE=$(nvm version-remote)

# utils

chpwd() {
    ls -a
    if [ "$PWD" != "$PREV_PWD" ]; then
        PREV_PWD="$PWD"
        if [ -e ".nvmrc" ]; then
            echo "\n${C_GREEN}nvmrc:${C_OFF} $(cat .nvmrc)"
        fi
        if [ -e "package.json" ]; then
            echo "${C_GREEN}node used:${C_OFF} $NODE_V_CURRENT"
            echo "${C_GREEN}node last:${C_OFF} $NODE_V_REMOTE"
        fi
    fi
}

# lang

export LANG="ru_RU.UTF-8"
export LC_CTYPE="ru_RU.UTF-8"
